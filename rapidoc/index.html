<!doctype html> <!-- Important: must specify -->
  <html>
  <head>
    <meta charset="utf-8"> <!-- Important: rapi-doc uses utf8 charecters -->
    <script src="https://unpkg.com/rapidoc/dist/rapidoc-min.js"></script>
	<script>
        function setApiKey(){
          var clientId = document.getElementById('clientId').value;
		  var clientSecret = document.getElementById('clientSecret').value;
		  
		  var reqUrl = 'https://troovo-ac-api-authorisation.azurewebsites.net/authorise';
		  var reqBody = {
			grant_type: 'client_credentials',
			client_id: clientId,
			client_secret: clientSecret
		  };
		  var data = 'grant_type=client_credentials';
		  data = data + '&client_id=' + clientId;
		  data = data + '&client_secret=' + encodeURIComponent(clientSecret);
		  
			fetch(reqUrl, {
			  method: 'POST',
			  body: data,
			  headers:{
				'Content-Type': 'application/x-www-form-urlencoded'
			  }
			}).then(res => res.json())
			.then(function(response) {
				if (response.error) {
					document.getElementById('authSuccess').style.visibility = 'hidden';
					document.getElementById('authFail').style.visibility = 'visible';					
				}
				else {
					document.getElementById('authFail').style.visibility = 'hidden';
					document.getElementById('authSuccess').style.visibility = 'visible';
				}
			})
			.catch(function(error) {
				document.getElementById('authSuccess').style.visibility = 'hidden';
				document.getElementById('authFail').style.visibility = 'visible';			
			});
		  
		  //const docEl = document.getElementById('thedoc');
          //const keyInputEl = document.getElementById('key-val-input');
          //docEl.setAttribute('api-key-name','api_key');
          //docEl.setAttribute('api-key-location','header');
          //docEl.setAttribute('api-key-value',keyInputEl.value);
        }
    </script>	
  </head>
  <body>
    <rapi-doc 
      spec-url="https://raw.githubusercontent.com/chrisjelly/pages/master/troovocore2.json" 
	  allow-authentication="false" 
	  allow-spec-url-load="false" 
	  allow-spec-file-load="false" 
    > 
		<div slot='header' style='display:flex; margin:0 16px;'> 
		  Client ID: <input class='txt' id='clientId' type='text' >
		  Client Secret: <input class='txt' id='clientSecret' type='text' >
		  <button class='btn' onclick='setApiKey()'> Login </button >
		  
		  <span id="authSuccess" visibility="hidden">Authenticated</span>
		  <span id="authFail" visibility="hidden">Unable to authenticate</span>
		</div>
	</rapi-doc>
  </body> 
  </html>