<!doctype html> <!-- Important: must specify -->
  <html>
  <head>
    <meta charset="utf-8"> <!-- Important: rapi-doc uses utf8 charecters -->
    <script src="https://unpkg.com/rapidoc/dist/rapidoc-min.js"></script>
	<script>
        function setApiKey(){
          var clientId = document.getElementById('clientId').value;
		  var clientSecret = document.getElementById('clientSecret').value;
		  document.getElementById('authMsg').textContent = '';
		  
		  var reqUrl = 'https://troovo-ac-api-authorisation.azurewebsites.net/authorise';
		  var reqBody = {
			grant_type: 'client_credentials',
			client_id: clientId,
			client_secret: clientSecret
		  };
		  var data = 'grant_type=client_credentials';
		  data = data + '&client_id=' + clientId;
		  data = data + '&client_secret=' + encodeURIComponent(clientSecret);
		  
			fetch(reqUrl, {
			  method: 'POST',
			  body: data,
			  headers:{
				'Content-Type': 'application/x-www-form-urlencoded'
			  }
			}).then(res => res.json())
			.then(function(response) {
				if (response.error) {
					document.getElementById('authMsg').textContent = 'Unable to authenticate';				
				}
				else {
					const msgEl = document.getElementById('authMsg');
					msgEl.textContent = 'Authenticated';
					
					const docEl = document.getElementById('thedoc');
					docEl.setAttribute('api-key-name','Authorization');
					docEl.setAttribute('api-key-location','header');
					docEl.setAttribute('api-key-value', 'Bearer ' + response.access_token);
				}
			})
			.catch(function(error) {
				document.getElementById('authMsg').textContent = 'Unable to authenticate';			
			}); 
        }
    </script>	
  </head>
  <body>
    <rapi-doc id="thedoc"
      spec-url="https://raw.githubusercontent.com/chrisjelly/pages/master/troovocore2.json" 
	  allow-authentication="false" 
	  allow-spec-url-load="false" 
	  allow-spec-file-load="false" 
    > 
		<div slot='header' style='display:flex; margin:0 16px;'> 
		  <div style="position: relative; top: 50%; transform: translateY(-25%); padding-left: 20px;">Client ID:</div> <input class='txt' id='clientId' type='text' />
		  <div style="position: relative; top: 50%; transform: translateY(-25%); padding-left: 20px;">Client Secret:</div> <input class='txt' id='clientSecret' type='text' />
		  <button class='btn' onclick='setApiKey()'> Login </button>
		  
		  <div id="authMsg" style="position: relative; top: 50%; transform: translateY(-25%); padding-left: 20px;"></span>
		</div>
	</rapi-doc>
  </body> 
  </html>